/* eslint-disable @typescript-eslint/camelcase */
export const getCommit = {
  sha: '9018e7fc4fb79058ac1ad50325564ff34b367b5f',
  node_id: 'MDY6Q29tbWl0MjE5ODgwNzEwOjkwMThlN2ZjNGZiNzkwNThhYzFhZDUwMzI1NTY0ZmYzNGIzNjdiNWY=',
  commit: {
    author: {
      name: 'Andy Brown',
      email: 'asbrown002@gmail.com',
      date: '2019-11-07T00:48:32Z',
    },
    committer: {
      name: 'GitHub',
      email: 'noreply@github.com',
      date: '2019-11-07T00:48:32Z',
    },
    message:
      "initial release (#1)\n\n* add action defition\r\n\r\n* add example workflow\r\n\r\n* initial commit of action logic\r\n\r\n* add runs-on property\r\n\r\n* checkout first\r\n\r\n* pass github token to action\r\n\r\n* update action path\r\n\r\n* revert path change\r\n\r\n* fix syntax error\r\n\r\n* fix query and add error handling\r\n\r\n* return early if error encountered\r\n\r\n* update number type\r\n\r\n* actually use correct type\r\n\r\n* correctly handle gql response\r\n\r\n* add extensions to inputs\r\n\r\n* support filtering by extension\r\n\r\n* add . for extensions for eslint cli compat\r\n\r\n* get extension when filtering\r\n\r\n* add support for files and ignore\r\n\r\n* create a check\r\n\r\n* add conclusion to check\r\n\r\n* add file annotations\r\n\r\n* commit lint error\r\n\r\n* log github context\r\n\r\n* better logging format\r\n\r\n* use correct sha\r\n\r\n* debug context again\r\n\r\n* get head sha from pr context\r\n\r\n* clean up\r\n\r\n* commit lint error\r\n\r\n* use static check name\r\n\r\n* fix lint errors\r\n\r\n* do not lint if no valid files\r\n\r\n* don't create check unless there are files to lint\r\n\r\n* add debug logs\r\n\r\n* update branding",
    tree: {
      sha: '482b8d1bd2dfe2533237f8fe051491340fe7c51e',
      url: 'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/git/trees/482b8d1bd2dfe2533237f8fe051491340fe7c51e',
    },
    url: 'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/git/commits/9018e7fc4fb79058ac1ad50325564ff34b367b5f',
    comment_count: 0,
    verification: {
      verified: true,
      reason: 'valid',
      signature:
        '-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdw2ngCRBK7hj4Ov3rIwAAdHIIAHQdoIz+Q1GV2vbANBAI3XE2\ntf+bBZ/uhj2Ox98U8eqEwy8pTlO0/PmrvE1+x9DwnbsOLD12g7PAc4QPWTTwZJFw\nFIs+G/8mvKSB7hEbAd27xFlLdKZR4ds69kQnKGQMfozNYNcz58Y/lUFnjGFA7BNi\nxqpfyKtdyX4GVzc6hH9m77MtLr6+vHqwjZfXRRPMHetKIxd8fTYr1dKmy5ftHMLX\nUmRkLJiAAaKXMJx537pM6EN9x8tcKJ50G9GjVQfB/lfdK+i8qLl/0HRTHf+JdXoK\nEynUdygGVRI7IXUSHnDfS4POQB0Xio2aP7FCBYq094d6Fv+NN1B2XaboEXKDo5M=\n=6S85\n-----END PGP SIGNATURE-----\n',
      payload:
        "tree 482b8d1bd2dfe2533237f8fe051491340fe7c51e\nparent c2cde66e0bcb6e25eb3e09e92d06093e119f58a5\nauthor Andy Brown <asbrown002@gmail.com> 1573087712 -0800\ncommitter GitHub <noreply@github.com> 1573087712 -0800\n\ninitial release (#1)\n\n* add action defition\r\n\r\n* add example workflow\r\n\r\n* initial commit of action logic\r\n\r\n* add runs-on property\r\n\r\n* checkout first\r\n\r\n* pass github token to action\r\n\r\n* update action path\r\n\r\n* revert path change\r\n\r\n* fix syntax error\r\n\r\n* fix query and add error handling\r\n\r\n* return early if error encountered\r\n\r\n* update number type\r\n\r\n* actually use correct type\r\n\r\n* correctly handle gql response\r\n\r\n* add extensions to inputs\r\n\r\n* support filtering by extension\r\n\r\n* add . for extensions for eslint cli compat\r\n\r\n* get extension when filtering\r\n\r\n* add support for files and ignore\r\n\r\n* create a check\r\n\r\n* add conclusion to check\r\n\r\n* add file annotations\r\n\r\n* commit lint error\r\n\r\n* log github context\r\n\r\n* better logging format\r\n\r\n* use correct sha\r\n\r\n* debug context again\r\n\r\n* get head sha from pr context\r\n\r\n* clean up\r\n\r\n* commit lint error\r\n\r\n* use static check name\r\n\r\n* fix lint errors\r\n\r\n* do not lint if no valid files\r\n\r\n* don't create check unless there are files to lint\r\n\r\n* add debug logs\r\n\r\n* update branding\r\n",
    },
  },
  url: 'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/commits/9018e7fc4fb79058ac1ad50325564ff34b367b5f',
  html_url: 'https://github.com/a-b-r-o-w-n/eslint-action/commit/9018e7fc4fb79058ac1ad50325564ff34b367b5f',
  comments_url:
    'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/commits/9018e7fc4fb79058ac1ad50325564ff34b367b5f/comments',
  author: {
    login: 'a-b-r-o-w-n',
    id: 3619060,
    node_id: 'MDQ6VXNlcjM2MTkwNjA=',
    avatar_url: 'https://avatars0.githubusercontent.com/u/3619060?v=4',
    gravatar_id: '',
    url: 'https://api.github.com/users/a-b-r-o-w-n',
    html_url: 'https://github.com/a-b-r-o-w-n',
    followers_url: 'https://api.github.com/users/a-b-r-o-w-n/followers',
    following_url: 'https://api.github.com/users/a-b-r-o-w-n/following{/other_user}',
    gists_url: 'https://api.github.com/users/a-b-r-o-w-n/gists{/gist_id}',
    starred_url: 'https://api.github.com/users/a-b-r-o-w-n/starred{/owner}{/repo}',
    subscriptions_url: 'https://api.github.com/users/a-b-r-o-w-n/subscriptions',
    organizations_url: 'https://api.github.com/users/a-b-r-o-w-n/orgs',
    repos_url: 'https://api.github.com/users/a-b-r-o-w-n/repos',
    events_url: 'https://api.github.com/users/a-b-r-o-w-n/events{/privacy}',
    received_events_url: 'https://api.github.com/users/a-b-r-o-w-n/received_events',
    type: 'User',
    site_admin: false,
  },
  committer: {
    login: 'web-flow',
    id: 19864447,
    node_id: 'MDQ6VXNlcjE5ODY0NDQ3',
    avatar_url: 'https://avatars3.githubusercontent.com/u/19864447?v=4',
    gravatar_id: '',
    url: 'https://api.github.com/users/web-flow',
    html_url: 'https://github.com/web-flow',
    followers_url: 'https://api.github.com/users/web-flow/followers',
    following_url: 'https://api.github.com/users/web-flow/following{/other_user}',
    gists_url: 'https://api.github.com/users/web-flow/gists{/gist_id}',
    starred_url: 'https://api.github.com/users/web-flow/starred{/owner}{/repo}',
    subscriptions_url: 'https://api.github.com/users/web-flow/subscriptions',
    organizations_url: 'https://api.github.com/users/web-flow/orgs',
    repos_url: 'https://api.github.com/users/web-flow/repos',
    events_url: 'https://api.github.com/users/web-flow/events{/privacy}',
    received_events_url: 'https://api.github.com/users/web-flow/received_events',
    type: 'User',
    site_admin: false,
  },
  parents: [
    {
      sha: 'c2cde66e0bcb6e25eb3e09e92d06093e119f58a5',
      url: 'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/commits/c2cde66e0bcb6e25eb3e09e92d06093e119f58a5',
      html_url: 'https://github.com/a-b-r-o-w-n/eslint-action/commit/c2cde66e0bcb6e25eb3e09e92d06093e119f58a5',
    },
  ],
  stats: {
    total: 451,
    additions: 443,
    deletions: 8,
  },
  files: [
    {
      sha: 'd8ce33784b26598aa004ab36f80459e91708949a',
      filename: '.github/workflows/main.yml',
      status: 'added',
      additions: 14,
      deletions: 0,
      changes: 14,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/.github/workflows/main.yml',
      raw_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/.github/workflows/main.yml',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/.github/workflows/main.yml?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        '@@ -0,0 +1,14 @@\n+name: Example Workflow\n+\n+on: [pull_request]\n+\n+jobs:\n+  test:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - uses: actions/checkout@v1\n+      - uses: ./\n+        with:\n+          repo-token: "${{ secrets.GITHUB_TOKEN }}"\n+          files: "src/**/*"',
    },
    {
      sha: '64365590b883fb8c1156b78337cf03510182bf96',
      filename: 'action.yml',
      status: 'added',
      additions: 21,
      deletions: 0,
      changes: 21,
      blob_url: 'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/action.yml',
      raw_url: 'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/action.yml',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/action.yml?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        '@@ -0,0 +1,21 @@\n+name: "Eslint Action"\n+description: "Lints changed files and annotates pull request diffs with errors."\n+inputs:\n+  repo-token:\n+    description: "Token used to interact with the Github API."\n+    required: true\n+  extensions:\n+    description: "File extensions to lint. Ex: .js,.jsx,.ts,.tsx"\n+    default: ".js,.jsx,.ts,.tsx"\n+  files:\n+    description: "Glob pattern of files to be linted."\n+    default: "**/*"\n+  ignore:\n+    description: "Glob pattern to ignore from linting."\n+    default: "**/node_modules/**"\n+runs:\n+  using: "node12"\n+  main: "lib/eslint-action.js"\n+branding:\n+  icon: "tool"\n+  color: "yellow"',
    },
    {
      sha: '1f1c1642edbd56598af814359fdeb29a63701818',
      filename: 'lib/eslint-action.js',
      status: 'added',
      additions: 183,
      deletions: 0,
      changes: 183,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/lib/eslint-action.js',
      raw_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/lib/eslint-action.js',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/lib/eslint-action.js?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        "@@ -0,0 +1,183 @@\n+\"use strict\";\n+var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n+    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n+    return new (P || (P = Promise))(function (resolve, reject) {\n+        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n+        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n+        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n+        step((generator = generator.apply(thisArg, _arguments || [])).next());\n+    });\n+};\n+var __importStar = (this && this.__importStar) || function (mod) {\n+    if (mod && mod.__esModule) return mod;\n+    var result = {};\n+    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n+    result[\"default\"] = mod;\n+    return result;\n+};\n+var __importDefault = (this && this.__importDefault) || function (mod) {\n+    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n+};\n+Object.defineProperty(exports, \"__esModule\", { value: true });\n+/* eslint-disable @typescript-eslint/camelcase */\n+const core = __importStar(require(\"@actions/core\"));\n+const github = __importStar(require(\"@actions/github\"));\n+const eslint_1 = __importDefault(require(\"eslint\"));\n+const minimatch_1 = __importDefault(require(\"minimatch\"));\n+const { GITHUB_WORKSPACE } = process.env;\n+const OWNER = github.context.repo.owner;\n+const REPO = github.context.repo.repo;\n+const CHECK_NAME = 'Eslint';\n+const getPrNumber = () => {\n+    const pullRequest = github.context.payload.pull_request;\n+    if (!pullRequest) {\n+        return;\n+    }\n+    return pullRequest.number;\n+};\n+const getSha = () => {\n+    const pullRequest = github.context.payload.pull_request;\n+    if (!pullRequest) {\n+        return github.context.sha;\n+    }\n+    return pullRequest.head.sha;\n+};\n+const processArrayInput = (key, required = false) => {\n+    return core\n+        .getInput(key, { required })\n+        .split(',')\n+        .map(e => e.trim());\n+};\n+const filterByGlob = (globs) => (file) => {\n+    for (const glob of globs) {\n+        if (minimatch_1.default(file, glob)) {\n+            return true;\n+        }\n+    }\n+    return false;\n+};\n+function fetchFilesBatch(client, prNumber, startCursor) {\n+    return __awaiter(this, void 0, void 0, function* () {\n+        const { repository } = yield client.graphql(`\n+    query ChangedFilesbatch($owner: String!, $repo: String!, $prNumber: Int!, $startCursor: String) {\n+      repository(owner: $owner, name: $repo) {\n+        pullRequest(number: $prNumber) {\n+          files(first: 100, after: $startCursor) {\n+            pageInfo {\n+              hasNextPage\n+              endCursor\n+            }\n+            totalCount\n+            edges {\n+              cursor\n+              node {\n+                path\n+              }\n+            }\n+          }\n+        }\n+      }\n+    }\n+  `, { owner: OWNER, repo: REPO, prNumber, startCursor });\n+        const pr = repository.pullRequest;\n+        if (!pr || !pr.files) {\n+            return { files: [] };\n+        }\n+        return Object.assign(Object.assign({}, pr.files.pageInfo), { files: pr.files.edges.map(e => e.node.path) });\n+    });\n+}\n+function getChangedFiles(client, prNumber, filesGlob) {\n+    return __awaiter(this, void 0, void 0, function* () {\n+        let files = [];\n+        let hasNextPage = true;\n+        let startCursor = undefined;\n+        while (hasNextPage) {\n+            try {\n+                const result = yield fetchFilesBatch(client, prNumber, startCursor);\n+                files = files.concat(result.files);\n+                hasNextPage = result.hasNextPage;\n+                startCursor = result.endCursor;\n+            }\n+            catch (err) {\n+                core.error(err);\n+                core.setFailed('Error occurred getting changed files.');\n+                return files.filter(filterByGlob(filesGlob));\n+            }\n+        }\n+        return files.filter(filterByGlob(filesGlob));\n+    });\n+}\n+function lint(files) {\n+    const extensions = processArrayInput('extensions', true);\n+    const ignoreGlob = processArrayInput('ignore');\n+    const linter = new eslint_1.default.CLIEngine({\n+        extensions,\n+        ignorePattern: ignoreGlob,\n+    });\n+    return linter.executeOnFiles(files);\n+}\n+function processReport(report) {\n+    const { errorCount, results } = report;\n+    const annotations = [];\n+    for (const result of results) {\n+        const { filePath, messages } = result;\n+        console.log(filePath);\n+        for (const lintMessage of messages) {\n+            const { line, severity, ruleId, message } = lintMessage;\n+            if (severity !== 2) {\n+                continue;\n+            }\n+            annotations.push({\n+                path: filePath.replace(`${GITHUB_WORKSPACE}/`, ''),\n+                start_line: line,\n+                end_line: line,\n+                annotation_level: 'failure',\n+                message: `[${ruleId}] ${message}`,\n+            });\n+        }\n+    }\n+    return {\n+        conclusion: errorCount > 0 ? 'failure' : 'success',\n+        output: {\n+            title: CHECK_NAME,\n+            summary: `${errorCount} error(s) found`,\n+            annotations,\n+        },\n+    };\n+}\n+function run() {\n+    return __awaiter(this, void 0, void 0, function* () {\n+        const token = core.getInput('repo-token', { required: true });\n+        const filesGlob = processArrayInput('files');\n+        const prNumber = getPrNumber();\n+        if (!prNumber) {\n+            return;\n+        }\n+        try {\n+            const oktokit = new github.GitHub(token);\n+            core.debug('Fetching files to lint.');\n+            const files = yield getChangedFiles(oktokit, prNumber, filesGlob);\n+            core.debug(`${files.length} files match ${filesGlob}.`);\n+            if (files.length > 0) {\n+                const { data: { id: checkId }, } = yield oktokit.checks.create({\n+                    owner: OWNER,\n+                    repo: REPO,\n+                    started_at: new Date().toISOString(),\n+                    head_sha: getSha(),\n+                    status: 'in_progress',\n+                    name: CHECK_NAME,\n+                });\n+                const report = lint(files);\n+                const payload = processReport(report);\n+                yield oktokit.checks.update(Object.assign({ owner: OWNER, repo: REPO, completed_at: new Date().toISOString(), status: 'completed', check_run_id: checkId }, payload));\n+            }\n+            else {\n+                core.info('No files to lint.');\n+            }\n+        }\n+        catch (err) {\n+            core.setFailed(err.message ? err.message : 'Error linting files.');\n+        }\n+    });\n+}\n+run();",
    },
    {
      sha: '9c664ba6fc4e1104da90691fa4840336bfd20f60',
      filename: 'node_modules/minimatch/package.json',
      status: 'modified',
      additions: 9,
      deletions: 7,
      changes: 16,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/node_modules/minimatch/package.json',
      raw_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/node_modules/minimatch/package.json',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/node_modules/minimatch/package.json?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        '@@ -1,28 +1,30 @@\n {\n-  "_from": "minimatch@^3.0.4",\n+  "_from": "minimatch",\n   "_id": "minimatch@3.0.4",\n   "_inBundle": false,\n   "_integrity": "sha512-yJHVQEhyqPLUTgt9B83PXu6W3rx4MvvHvSUvToogpwoGDOUQ+yDrR0HRot+yOCdCO7u4hX3pWft6kWBBcqh0UA==",\n   "_location": "/minimatch",\n   "_phantomChildren": {},\n   "_requested": {\n-    "type": "range",\n+    "type": "tag",\n     "registry": true,\n-    "raw": "minimatch@^3.0.4",\n+    "raw": "minimatch",\n     "name": "minimatch",\n     "escapedName": "minimatch",\n-    "rawSpec": "^3.0.4",\n+    "rawSpec": "",\n     "saveSpec": null,\n-    "fetchSpec": "^3.0.4"\n+    "fetchSpec": "latest"\n   },\n   "_requiredBy": [\n+    "#USER",\n+    "/",\n     "/eslint",\n     "/glob"\n   ],\n   "_resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.0.4.tgz",\n   "_shasum": "5166e286457f03306064be5497e8dbb0c3d32083",\n-  "_spec": "minimatch@^3.0.4",\n-  "_where": "/Users/abrown/code/eslint-action/node_modules/eslint",\n+  "_spec": "minimatch",\n+  "_where": "/Users/abrown/code/eslint-action",\n   "author": {\n     "name": "Isaac Z. Schlueter",\n     "email": "i@izs.me",',
    },
    {
      sha: '0987b4aafd0b8a51f0eb68d9263026537882513c',
      filename: 'package.json',
      status: 'modified',
      additions: 2,
      deletions: 1,
      changes: 3,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/package.json',
      raw_url: 'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/package.json',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/package.json?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        '@@ -21,7 +21,8 @@\n   "dependencies": {\n     "@actions/core": "^1.2.0",\n     "@actions/github": "^1.1.0",\n-    "eslint": "^6.6.0"\n+    "eslint": "^6.6.0",\n+    "minimatch": "^3.0.4"\n   },\n   "devDependencies": {\n     "@types/eslint": "^6.1.3",',
    },
    {
      sha: 'd558cf8dacd37c85c0bb4b90ae3081c36a9b40db',
      filename: 'src/eslint-action.ts',
      status: 'added',
      additions: 202,
      deletions: 0,
      changes: 202,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/src/eslint-action.ts',
      raw_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/src/eslint-action.ts',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/src/eslint-action.ts?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        "@@ -0,0 +1,202 @@\n+/* eslint-disable @typescript-eslint/camelcase */\n+import * as core from '@actions/core';\n+import * as github from '@actions/github';\n+import eslint, { CLIEngine } from 'eslint';\n+import minimatch from 'minimatch';\n+import { ChecksUpdateParams, ChecksUpdateParamsOutputAnnotations } from '@octokit/rest';\n+\n+const { GITHUB_WORKSPACE } = process.env;\n+const OWNER = github.context.repo.owner;\n+const REPO = github.context.repo.repo;\n+const CHECK_NAME = 'Eslint';\n+\n+const getPrNumber = (): number | undefined => {\n+  const pullRequest = github.context.payload.pull_request;\n+\n+  if (!pullRequest) {\n+    return;\n+  }\n+\n+  return pullRequest.number;\n+};\n+\n+const getSha = (): string => {\n+  const pullRequest = github.context.payload.pull_request;\n+\n+  if (!pullRequest) {\n+    return github.context.sha;\n+  }\n+\n+  return pullRequest.head.sha;\n+};\n+\n+const processArrayInput = (key: string, required = false): string[] => {\n+  return core\n+    .getInput(key, { required })\n+    .split(',')\n+    .map(e => e.trim());\n+};\n+\n+const filterByGlob = (globs: string[]) => (file: string): boolean => {\n+  for (const glob of globs) {\n+    if (minimatch(file, glob)) {\n+      return true;\n+    }\n+  }\n+\n+  return false;\n+};\n+\n+async function fetchFilesBatch(client: github.GitHub, prNumber: number, startCursor?: string): Promise<PrResponse> {\n+  const { repository } = await client.graphql(\n+    `\n+    query ChangedFilesbatch($owner: String!, $repo: String!, $prNumber: Int!, $startCursor: String) {\n+      repository(owner: $owner, name: $repo) {\n+        pullRequest(number: $prNumber) {\n+          files(first: 100, after: $startCursor) {\n+            pageInfo {\n+              hasNextPage\n+              endCursor\n+            }\n+            totalCount\n+            edges {\n+              cursor\n+              node {\n+                path\n+              }\n+            }\n+          }\n+        }\n+      }\n+    }\n+  `,\n+    { owner: OWNER, repo: REPO, prNumber, startCursor }\n+  );\n+\n+  const pr = repository.pullRequest;\n+\n+  if (!pr || !pr.files) {\n+    return { files: [] };\n+  }\n+\n+  return {\n+    ...pr.files.pageInfo,\n+    files: pr.files.edges.map(e => e.node.path),\n+  };\n+}\n+\n+async function getChangedFiles(client: github.GitHub, prNumber: number, filesGlob: string[]): Promise<string[]> {\n+  let files: string[] = [];\n+  let hasNextPage = true;\n+  let startCursor: string | undefined = undefined;\n+\n+  while (hasNextPage) {\n+    try {\n+      const result = await fetchFilesBatch(client, prNumber, startCursor);\n+\n+      files = files.concat(result.files);\n+      hasNextPage = result.hasNextPage;\n+      startCursor = result.endCursor;\n+    } catch (err) {\n+      core.error(err);\n+      core.setFailed('Error occurred getting changed files.');\n+      return files.filter(filterByGlob(filesGlob));\n+    }\n+  }\n+\n+  return files.filter(filterByGlob(filesGlob));\n+}\n+\n+function lint(files: string[]): CLIEngine.LintReport {\n+  const extensions = processArrayInput('extensions', true);\n+  const ignoreGlob = processArrayInput('ignore');\n+\n+  const linter = new eslint.CLIEngine({\n+    extensions,\n+    ignorePattern: ignoreGlob,\n+  });\n+\n+  return linter.executeOnFiles(files);\n+}\n+\n+function processReport(report: CLIEngine.LintReport): Partial<ChecksUpdateParams> {\n+  const { errorCount, results } = report;\n+  const annotations: ChecksUpdateParamsOutputAnnotations[] = [];\n+\n+  for (const result of results) {\n+    const { filePath, messages } = result;\n+\n+    console.log(filePath);\n+    for (const lintMessage of messages) {\n+      const { line, severity, ruleId, message } = lintMessage;\n+\n+      if (severity !== 2) {\n+        continue;\n+      }\n+\n+      annotations.push({\n+        path: filePath.replace(`${GITHUB_WORKSPACE}/`, ''),\n+        start_line: line,\n+        end_line: line,\n+        annotation_level: 'failure',\n+        message: `[${ruleId}] ${message}`,\n+      });\n+    }\n+  }\n+\n+  return {\n+    conclusion: errorCount > 0 ? 'failure' : 'success',\n+    output: {\n+      title: CHECK_NAME,\n+      summary: `${errorCount} error(s) found`,\n+      annotations,\n+    },\n+  };\n+}\n+\n+async function run(): Promise<void> {\n+  const token = core.getInput('repo-token', { required: true });\n+  const filesGlob = processArrayInput('files');\n+  const prNumber = getPrNumber();\n+\n+  if (!prNumber) {\n+    return;\n+  }\n+\n+  try {\n+    const oktokit = new github.GitHub(token);\n+    core.debug('Fetching files to lint.');\n+    const files = await getChangedFiles(oktokit, prNumber, filesGlob);\n+    core.debug(`${files.length} files match ${filesGlob}.`);\n+\n+    if (files.length > 0) {\n+      const {\n+        data: { id: checkId },\n+      } = await oktokit.checks.create({\n+        owner: OWNER,\n+        repo: REPO,\n+        started_at: new Date().toISOString(),\n+        head_sha: getSha(),\n+        status: 'in_progress',\n+        name: CHECK_NAME,\n+      });\n+      const report = lint(files);\n+      const payload = processReport(report);\n+\n+      await oktokit.checks.update({\n+        owner: OWNER,\n+        repo: REPO,\n+        completed_at: new Date().toISOString(),\n+        status: 'completed',\n+        check_run_id: checkId,\n+        ...payload,\n+      });\n+    } else {\n+      core.info('No files to lint.');\n+    }\n+  } catch (err) {\n+    core.setFailed(err.message ? err.message : 'Error linting files.');\n+  }\n+}\n+\n+run();",
    },
    {
      sha: '9c1d2af2f8a78d840644ea6e58a06b308f3850e5',
      filename: 'src/types.d.ts',
      status: 'added',
      additions: 12,
      deletions: 0,
      changes: 12,
      blob_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/blob/9018e7fc4fb79058ac1ad50325564ff34b367b5f/src/types.d.ts',
      raw_url:
        'https://github.com/a-b-r-o-w-n/eslint-action/raw/9018e7fc4fb79058ac1ad50325564ff34b367b5f/src/types.d.ts',
      contents_url:
        'https://api.github.com/repos/a-b-r-o-w-n/eslint-action/contents/src/types.d.ts?ref=9018e7fc4fb79058ac1ad50325564ff34b367b5f',
      patch:
        '@@ -0,0 +1,12 @@\n+declare namespace NodeJS {\n+  export interface ProcessEnv {\n+    GITHUB_ACTION: string;\n+    GITHUB_WORKSPACE: string;\n+  }\n+}\n+\n+interface PrResponse {\n+  endCursor?: string;\n+  hasNextPage?: boolean;\n+  files: string[];\n+}',
    },
  ],
};
